<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบจองห้องปฏิบัติการวิทยาศาสตร์</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f8f9fa;
            display: flex; 
            flex-direction: column; 
            min-height: 100vh; 
        }
        #app {
            flex-grow: 1; 
        }
        .nav-tabs .nav-link {
            color: #495057;
            border-radius: 0.5rem 0.5rem 0 0;
            cursor: pointer;
        }
        .nav-tabs .nav-link.active {
            color: #007bff;
            background-color: #fff;
            border-color: #dee2e6 #dee2e6 #fff;
            font-weight: bold;
        }
        .tab-content {
            border: 1px solid #dee2e6;
            border-top: none;
            padding: 1.5rem;
            background-color: #fff;
            border-radius: 0 0 0.5rem 0.5rem;
        }
        .table th, .table td {
            vertical-align: middle;
            word-break: break-word; 
        }
        table.dataTable th,
        table.dataTable td {
            white-space: nowrap; 
        }
        table.dataTable.dtr-inline.collapsed>tbody>tr>td.dtr-control:before, 
        table.dataTable.dtr-inline.collapsed>tbody>tr>th.dtr-control:before {
            background-color: #007bff; 
        }
        .dataTables_wrapper .dataTables_paginate .paginate_button {
            padding: 0.3em 0.8em;
        }
        .dataTables_wrapper .dataTables_filter input {
            margin-left: 0.5em;
            display: inline-block;
            width: auto;
        }
        .status-available { 
            color: green;
            font-weight: bold;
        }
        .status-booked {
            color: red;
            font-weight: bold;
            font-size: 0.85em; 
        }
        .form-label {
            font-weight: bold;
        }
        .card-lab {
            margin-bottom: 1rem;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.7);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .btn-book-now {
            font-size: 0.8rem;
            padding: 0.2rem 0.4rem;
        }
        .home-status-container {
            min-height: 30px; 
            display: flex;
            align-items: center;
            justify-content: flex-end; 
            text-align: right;
        }
        #fullcalendar-container {
            margin-top: 1rem;
        }
        .fc-event {
            cursor: pointer;
        }
        .fc-event-title {
            white-space: normal;
        }
        .fc-list-day-today .fc-list-day-text,
        .fc-list-day-today .fc-list-day-side-text {
            background-color: #fff3cd; 
            font-weight: bold;
            border-radius: 4px;
        }
        .fc .fc-list-day-cushion.fc-list-day-today { 
            background-color: #e9f5ff !important; 
        }
        .form-control.is-invalid, .form-select.is-invalid {
            border-color: #dc3545;
        }
        .form-control.is-valid, .form-select.is-valid {
            border-color: #198754;
        }
        .invalid-feedback {
            display: none; 
            width: 100%;
            margin-top: .25rem;
            font-size: .875em;
            color: #dc3545;
        }
        .was-validated .form-control:invalid ~ .invalid-feedback,
        .was-validated .form-select:invalid ~ .invalid-feedback {
            display: block;
        }
        .app-banner {
            width: 100%;
            max-height: 300px; 
            object-fit: cover; 
            border-radius: 0.5rem;
            margin-bottom: 1.5rem; 
        }
        .user-name-display {
            background-color: #e9ecef; /* Light grey to indicate readonly */
            padding: .375rem .75rem;
            border-radius: .25rem;
            border: 1px solid #ced4da;
            min-height: calc(1.5em + .75rem + 2px); /* Match form-control height */
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app" class="container-fluid mt-4 mb-4 mx-15">
        <div class="card shadow-sm border-primary position-relative app-content-wrapper" style="padding: 15px; margin-bottom: 2px; border-radius: 20px; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);">
            <div class="text-center"> 
                <img src="https://lh5.googleusercontent.com/d/1Ihnlbpt0aCgC4rC7M8lIHymAQkkRnY1Q" 
                     alt="Form Banner" 
                     class="app-banner img-fluid"
                     onerror="this.onerror=null;this.src='https://placehold.co/1200x300/007bff/white?text=Science+Lab+Booking+System';">
            </div>

            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link" :class="{ active: activeTab === 'home' }" @click="changeTab('home')" type="button">
                        <i class="fas fa-home"></i> หน้าหลัก (สถานะห้อง)
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" :class="{ active: activeTab === 'form' }" @click="changeTab('form')" type="button">
                        <i class="fas fa-edit"></i> แบบฟอร์มการจอง
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" :class="{ active: activeTab === 'table' }" @click="changeTab('table')" type="button">
                        <i class="fas fa-table"></i> ตารางข้อมูลการจอง
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" :class="{ active: activeTab === 'calendar' }" @click="changeTab('calendar')" type="button">
                        <i class="fas fa-calendar-alt"></i> ปฏิทินการจอง
                    </button>
                </li>
            </ul>

            <div class="tab-content" id="myTabContent">
                <div v-if="isLoading" class="loading-overlay">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">กำลังโหลด...</span>
                    </div>
                </div>

                <div v-if="activeTab === 'home'" class="p-3">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 class="mb-0">สถานะการใช้ห้องปฏิบัติการ</h2>
                        <div class="col-md-4">
                            <label for="homeDateSelect" class="form-label visually-hidden">เลือกวันที่:</label>
                            <select id="homeDateSelect" v-model="homeSelectedDate" @change="fetchBookings" class="form-select form-select-sm">
                                <option v-for="date in availableDatesForForm" :key="date.value" :value="date.value">{{ date.text }}</option>
                            </select>
                        </div>
                    </div>
                    <p class="text-muted mb-3">วันที่: {{ formatDate(homeSelectedDate, 'full') }}</p>
                    <div class="row">
                        <div v-for="lab in labs" :key="lab.id" class="col-md-4">
                            <div class="card card-lab shadow-sm">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="mb-0"><i class="fas fa-door-open"></i> {{ lab.name }}</h5>
                                </div>
                                <ul class="list-group list-group-flush">
                                    <li v-for="period in periods" :key="period.value" class="list-group-item d-flex justify-content-between align-items-center">
                                        <span>{{ period.text }}</span>
                                        <div class="home-status-container">
                                            <span v-if="isPeriodBooked(lab.id, homeSelectedDate, period.value)" :class="getLabPeriodStatusClass(lab.id, homeSelectedDate, period.value)">
                                                {{ getLabPeriodStatusText(lab.id, homeSelectedDate, period.value) }}
                                            </span>
                                            <button v-else @click="goToBookingForm(lab.id, period.value, homeSelectedDate)" class="btn btn-sm btn-success ms-2 btn-book-now">
                                                <i class="fas fa-plus-circle"></i> จอง
                                            </button>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                     <p class="mt-3 text-muted"><small>*สถานะอัปเดตจากข้อมูลการจองที่มีในระบบ</small></p>
                </div>

                <div v-if="activeTab === 'form'" class="p-3">
                    <h2 class="mb-3">แบบฟอร์มการจองห้องปฏิบัติการ</h2>
                    <form @submit.prevent="handleFormSubmitAttempt" id="bookingForm" class="needs-validation" novalidate>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="userPIN" class="form-label">รหัสประจำผู้จอง:</label>
                                <input type="password" id="userPIN" v-model="formData.userPIN" @blur="fetchUserNameByPIN" class="form-control" required>
                                <div class="invalid-feedback" id="userPINFeedback">
                                    กรุณากรอกรหัสประจำผู้จอง
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="userNameDisplay" class="form-label">ชื่อผู้ขอใช้:</label>
                                <input type="text" id="userNameDisplay" class="form-control" :value="formData.userName" placeholder="จะแสดงอัตโนมัติหลังกรอกรหัส" readonly required>
                                <!-- The 'required' attribute on a readonly input might behave differently across browsers for validation.
                                     We'll rely on checking formData.userName in submit logic. -->
                                <div class="invalid-feedback" id="userNameFeedback">
                                     กรุณากรอกรหัสผู้จองที่ถูกต้องเพื่อแสดงชื่อ
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3"> 
                                <label for="lab" class="form-label">ห้องปฏิบัติการที่ขอใช้:</label>
                                <select id="lab" v-model="formData.lab" class="form-select" required>
                                    <option disabled value="">เลือกห้องปฏิบัติการ...</option>
                                    <option v-for="labItem in labs" :key="labItem.id" :value="labItem.id">{{ labItem.name }}</option>
                                </select>
                                <div class="invalid-feedback">
                                    กรุณาเลือกห้องปฏิบัติการ
                                </div>
                            </div>
                            <div class="col-md-6 mb-3"> 
                                <label for="bookingDate" class="form-label">วันที่ขอใช้:</label>
                                <select id="bookingDate" v-model="formData.bookingDate" class="form-select" required>
                                    <option disabled value="">เลือกวันที่...</option>
                                    <option v-for="date in availableDatesForForm" :key="date.value" :value="date.value">{{ date.text }}</option>
                                </select>
                                <div class="invalid-feedback">
                                    กรุณาเลือกวันที่ขอใช้
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3"> 
                                <label for="startPeriod" class="form-label">คาบเรียนเริ่มต้น:</label>
                                <select id="startPeriod" v-model="formData.startPeriodValue" class="form-select" required>
                                    <option disabled value="">เลือกคาบเริ่มต้น...</option>
                                    <option v-for="p in periods" :key="p.value" :value="p.value">{{ p.text }}</option>
                                </select>
                                <div class="invalid-feedback">
                                    กรุณาเลือกคาบเรียนเริ่มต้น
                                </div>
                            </div>
                            <div class="col-md-6 mb-3"> 
                                <label for="endPeriod" class="form-label">คาบเรียนสิ้นสุด:</label>
                                <select id="endPeriod" v-model="formData.endPeriodValue" class="form-select" required>
                                    <option disabled value="">เลือกคาบสิ้นสุด...</option>
                                    <option v-for="p in periods" :key="p.value" :value="p.value" :disabled="isEndPeriodDisabled(p.value)">{{ p.text }}</option>
                                </select>
                                <div class="invalid-feedback">
                                    กรุณาเลือกคาบเรียนสิ้นสุด
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="studentClass" class="form-label">สอนนักเรียน ชั้น:</label>
                                <input type="text" id="studentClass" v-model="formData.studentClass" class="form-control" required>
                                <div class="invalid-feedback">
                                    กรุณาระบุชั้นเรียนของนักเรียน
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="studentCount" class="form-label">จำนวนนักเรียน:</label>
                                <input type="number" id="studentCount" v-model="formData.studentCount" class="form-control" min="1" required>
                                <div class="invalid-feedback">
                                    กรุณาระบุจำนวนนักเรียน (อย่างน้อย 1 คน)
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="topic" class="form-label">เรื่องที่สอน:</label>
                            <textarea id="topic" v-model="formData.topic" class="form-control" rows="3" required></textarea>
                            <div class="invalid-feedback">
                                กรุณาระบุเรื่องที่สอน
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="materialsFile" class="form-label">วัสดุ/อุปกรณ์/สารเคมี ที่ต้องการ (แนบไฟล์หรือถ่ายรูป):</label>
                            <input type="file" id="materialsFile" @change="handleFileUpload" class="form-control">
                            <small class="form-text text-muted">ขนาดไฟล์ไม่เกิน 10MB. ประเภทไฟล์ที่อนุญาต: รูปภาพ, PDF, Word, Excel, PowerPoint, Text.</small>
                            </div>
                        
                        <button type="submit" class="btn btn-primary w-100"><i class="fas fa-check-circle"></i> ยืนยันการจอง</button>
                    </form>
                </div>

                <div v-if="activeTab === 'table'" class="p-3">
                    <h2 class="mb-3">ตารางข้อมูลการจองทั้งหมด</h2>
                     <div class="table-responsive">
                        <table id="bookingsTableAll" :key="'bookingsTable-all-data'" class="table table-striped table-hover table-bordered w-100">
                            <thead class="table-dark">
                                <tr>
                                    <th>ห้องปฏิบัติการ</th>
                                    <th>วันที่ขอใช้</th>
                                    <th>คาบเริ่มต้น</th>
                                    <th>คาบสิ้นสุด</th>
                                    <th>ชื่อผู้ขอใช้</th>
                                    <th>สอนนักเรียน ชั้น</th>
                                    <th>เรื่องที่สอน</th>
                                    <th>ไฟล์แนบ</th>
                                    <th>วันที่จองระบบ</th>
                                </tr>
                            </thead>
                            <tbody>
                                 <tr v-for="booking in sortedAllBookings" :key="booking.id">
                                    <td>{{ getLabName(booking.lab) }}</td>
                                    <td>{{ formatDate(booking.bookingDate, 'short') }}</td>
                                    <td>{{ getPeriodDisplay(booking.startPeriodValue, 'start') }}</td>
                                    <td>{{ getPeriodDisplay(booking.endPeriodValue, 'end') }}</td>
                                    <td>{{ booking.userName }}</td>
                                    <td>{{ booking.studentClass }}</td>
                                    <td>{{ booking.topic }}</td>
                                    <td>
                                        <a v-if="booking.materialsFileLink" :href="booking.materialsFileLink" target="_blank" class="text-primary" :title="'ดูไฟล์: ' + booking.materialsFileName">
                                            <i class="fas fa-paperclip"></i>
                                        </a>
                                        <span v-else-if="booking.materialsFileName" class="text-muted" :title="booking.materialsFileName + ' (ไม่มีลิงก์)'">
                                            <i class="fas fa-paperclip"></i>
                                        </span>
                                        <span v-else></span>
                                    </td>
                                    <td>{{ formatDate(booking.submissionTimestamp, 'datetime') }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div v-if="activeTab === 'calendar'" class="p-3">
                    <h2 class="mb-3">ปฏิทินการจอง</h2>
                    <ul class="nav nav-pills mb-3">
                        <li class="nav-item">
                             <a class="nav-link" :class="{ active: calendarActiveLabTab === 'all' }" @click.prevent="calendarActiveLabTab = 'all'" href="#">ทั้งหมด</a>
                        </li>
                        <li v-for="labItem in labs" :key="labItem.id" class="nav-item">
                            <a class="nav-link" :class="{ active: calendarActiveLabTab === labItem.id }" @click.prevent="calendarActiveLabTab = labItem.id" href="#">
                                {{ labItem.name }}
                            </a>
                        </li>
                    </ul>
                    <div id="fullcalendar-container"></div>
                </div>
				<footer style="text-align: center;background-color:#faff99; padding: 10px 0; margin-top: auto; border-top: 1px solid #e0e0e0; font-size: 0.9em; color: #555; width: 100%;">
					:: Created and Develop by KT|Tanasarn Sirak ::
					<div class="container text-center">
					<a href="https://line.me/ti/p/3F7VGrqgUr" target="_blank"><i class="fa-solid fa-comments"></i></a> <a style="color:red;text-decoration:none;font-size:12px" href="https://line.me/ti/p/3F7VGrqgUr" target="_blank"> สอบถาม/แจ้งปัญหา :: <span style="font-size:12px;color:black">KT | Tanasarn Sirak © <script>document.write(new Date().getFullYear()+543)</script> </a>
					</div>
				</footer>
            </div> 
        </div> 
    </div> 

    

    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales-all.min.js'></script> 
    <script src="https://cdn.jsdelivr.net/npm/vue@3.4.27/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        const App = {
            data() {
                return {
                    activeTab: 'home',
                    appsScriptUrl: 'https://script.google.com/macros/s/AKfycbwH1NLxoY9k4GUalCRzxJdXNqxMPJ0P8L-F0zIhWFDdgOJgySCMXjNi7i9lEISI9nfM8g/exec', 
                    // teachers array is no longer needed as userName is fetched
                    labs: [
                        { id: 'physics', name: 'ห้องฟิสิกส์', color: '#007bff' },
                        { id: 'chemistry', name: 'ห้องเคมี', color: '#28a745' },
                        { id: 'biology', name: 'ห้องชีววิทยา', color: '#ffc107' }
                    ],
                    periods: [
                        { value: "08:30-09:25", text: "คาบ 1 (08.30-09.25 น.)", startTime: "08:30", endTime: "09:25", periodNumberText: "คาบ 1" },
                        { value: "09:25-10:20", text: "คาบ 2 (09.25-10.20 น.)", startTime: "09:25", endTime: "10:20", periodNumberText: "คาบ 2" },
                        { value: "10:20-11:15", text: "คาบ 3 (10.20-11.15 น.)", startTime: "10:20", endTime: "11:15", periodNumberText: "คาบ 3" },
                        { value: "11:15-12:10", text: "คาบ 4 (11.15-12.10 น.)", startTime: "11:15", endTime: "12:10", periodNumberText: "คาบ 4" },
                        { value: "12:10-13:05", text: "คาบ 5 (12.10-13.05 น.)", startTime: "12:10", endTime: "13:05", periodNumberText: "คาบ 5" },
                        { value: "13:05-14:00", text: "คาบ 6 (13.05-14.00 น.)", startTime: "13:05", endTime: "14:00", periodNumberText: "คาบ 6" },
                        { value: "14:00-14:55", text: "คาบ 7 (14.00-14.55 น.)", startTime: "14:00", endTime: "14:55", periodNumberText: "คาบ 7" },
                        { value: "14:55-15:50", text: "คาบ 8 (14.55-15.50 น.)", startTime: "14:55", endTime: "15:50", periodNumberText: "คาบ 8" },
                        { value: "16:30-17:30", text: "คาบ 9 (16.30-17.30 น.)", startTime: "16:30", endTime: "17:30", periodNumberText: "คาบ 9" }
                    ],
                    formData: {
                        userPIN: '', 
                        userName: '', // Will be auto-filled
                        lab: '', bookingDate: '', startPeriodValue: '', endPeriodValue: '',
                        studentClass: '', studentCount: null, topic: '', materialsFile: null, materialsFileName: ''
                    },
                    bookings: [],
                    availableDatesForForm: [], 
                    homeSelectedDate: '', 
                    mainBookingsTableInstance: null, 
                    calendarActiveLabTab: 'all', 
                    isLoading: false,
                    calendarInstance: null,
                    // isUserNameDisabled: false, // No longer needed for select, input is readonly
                    // userNamePlaceholder: "จะแสดงอัตโนมัติหลังกรอกรหัส", // Placeholder is now on the input
                };
            },
            computed: {
                todayString() {
                    const today = new Date();
                    return `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
                },
                sortedAllBookings() { 
                    return [...this.bookings].sort((a, b) => {
                            const dateA = new Date(`${a.bookingDate}T${this.getPeriodDetails(a.startPeriodValue)?.startTime || '00:00'}`);
                            const dateB = new Date(`${b.bookingDate}T${this.getPeriodDetails(b.startPeriodValue)?.startTime || '00:00'}`);
                            return dateB - dateA; 
                        });
                }
            },
            methods: {
                getLabColor(labId) {
                    const lab = this.labs.find(l => l.id === labId);
                    return lab ? lab.color : '#6c757d'; 
                },
                getCalendarEvents() {
                    return this.bookings
                        .filter(b => this.calendarActiveLabTab === 'all' || b.lab === this.calendarActiveLabTab)
                        .map(booking => {
                            const startDetails = this.getPeriodDetails(booking.startPeriodValue);
                            const endDetails = this.getPeriodDetails(booking.endPeriodValue);
                            if (!startDetails || !endDetails) return null;

                            return {
                                id: booking.id,
                                title: `${this.getLabName(booking.lab)}: ${booking.userName} (${booking.topic.substring(0,20)}${booking.topic.length > 20 ? '...' : ''})`,
                                start: `${booking.bookingDate}T${startDetails.startTime}`,
                                end: `${booking.bookingDate}T${endDetails.endTime}`,
                                extendedProps: {
                                    lab: booking.lab,
                                    labNameDisplay: this.getLabName(booking.lab),
                                    periodTextDisplay: this.generateFullPeriodText(booking.startPeriodValue, booking.endPeriodValue),
                                    originalBooking: booking 
                                },
                                backgroundColor: this.getLabColor(booking.lab),
                                borderColor: this.getLabColor(booking.lab)
                            };
                        }).filter(event => event !== null);
                },
                handleCalendarEventClick(info) {
                    const booking = info.event.extendedProps.originalBooking;
                    let details = `<b>ผู้จอง:</b> ${booking.userName}<br>`;
                    details += `<b>ห้อง:</b> ${info.event.extendedProps.labNameDisplay}<br>`;
                    details += `<b>เรื่อง:</b> ${booking.topic}<br>`;
                    details += `<b>ชั้น:</b> ${booking.studentClass}<br>`;
                    if(booking.materialsFileName){
                        details += `<b>ไฟล์แนบ:</b> ${booking.materialsFileName}`;
                        if(booking.materialsFileLink && booking.materialsFileLink !== '#'){
                             details += ` <a href="${booking.materialsFileLink}" target="_blank">(ดูไฟล์)</a>`;
                        } else if (booking.materialsFileName) {
                            details += ` (ไม่มีลิงก์)`;
                        }
                    }
                    Swal.fire({
                        title: info.event.extendedProps.periodTextDisplay,
                        html: `<div style="text-align:left; white-space:pre-wrap;">${details}</div>`,
                        icon: 'info',
                        confirmButtonText: 'ปิด'
                    });
                },
                initializeFullCalendar() {
                    if (this.calendarInstance) {
                        this.calendarInstance.destroy();
                        this.calendarInstance = null;
                    }
                    const calendarEl = document.getElementById('fullcalendar-container');
                    if (!calendarEl) {
                        console.error("FullCalendar container not found");
                        return;
                    }

                    this.$nextTick(() => {
                        this.calendarInstance = new FullCalendar.Calendar(calendarEl, {
                            locale: 'th',
                            headerToolbar: {
                                left: 'prev,next today',
                                center: 'title',
                                right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
                            },
                            buttonText: {
                                today: 'วันนี้',
                                month: 'เดือน',
                                week: 'สัปดาห์',
                                day: 'วัน',
                                list: 'รายการ'
                            },
                            initialView: 'listWeek', 
                            navLinks: true,
                            editable: false,
                            selectable: false,
                            dayMaxEvents: true, 
                            events: this.getCalendarEvents(),
                            eventClick: this.handleCalendarEventClick,
                        });
                        this.calendarInstance.render();
                    });
                },
                destroyFullCalendar() {
                    if (this.calendarInstance) {
                        this.calendarInstance.destroy();
                        this.calendarInstance = null;
                    }
                },
                initializeBookingsTable() { 
                    const tableId = '#bookingsTableAll';
                    if (this.mainBookingsTableInstance) { 
                        this.mainBookingsTableInstance.destroy();
                        this.mainBookingsTableInstance = null;
                    }
                    this.$nextTick(() => {
                        const tableElement = $(tableId);
                        if (tableElement.length > 0) { 
                            let dtOrder = [];
                            if (this.sortedAllBookings.length > 0) {
                                dtOrder = [[1, 'desc'], [2, 'asc']]; 
                            }
                            
                            this.mainBookingsTableInstance = tableElement.DataTable({
                                responsive: true,
                                order: dtOrder, 
                                destroy: true,
                            });
                        }
                    });
                },
                destroyBookingsTable() { 
                    if (this.mainBookingsTableInstance) {
                        this.mainBookingsTableInstance.destroy();
                        this.mainBookingsTableInstance = null;
                    }
                },
                getPeriodDetails(periodValue) {
                    return this.periods.find(p => p.value === periodValue);
                },
                isEndPeriodDisabled(periodValue) {
                    if (!this.formData.startPeriodValue) return false;
                    const startIndex = this.periods.findIndex(p => p.value === this.formData.startPeriodValue);
                    const currentIndex = this.periods.findIndex(p => p.value === periodValue);
                    return currentIndex < startIndex;
                },
                goToBookingForm(labId, periodValue, dateForBooking) {
                    this.activeTab = 'form';
                    const form = document.getElementById('bookingForm');
                    if (form) form.classList.remove('was-validated');
                    const pinInput = document.getElementById('userPIN');
                    if (pinInput) pinInput.classList.remove('is-invalid', 'is-valid');


                    this.formData.lab = labId;
                    this.formData.bookingDate = dateForBooking || this.todayString; 
                    this.formData.startPeriodValue = periodValue;
                    this.formData.endPeriodValue = periodValue;
                    this.formData.userPIN = ''; 
                    this.formData.userName = ''; 
                },
                changeTab(tabName) {
                    if (this.activeTab === 'table' && tabName !== 'table') {
                        this.destroyBookingsTable(); 
                    }
                    if (this.activeTab === 'calendar' && tabName !== 'calendar') {
                        this.destroyFullCalendar();
                    }
                     if (this.activeTab === 'form' && tabName !== 'form') {
                        const form = document.getElementById('bookingForm');
                        if (form) form.classList.remove('was-validated');
                         this.formData.userPIN = ''; 
                         this.formData.userName = '';
                    }

                    this.activeTab = tabName;

                    if (tabName === 'table') {
                        this.fetchBookings().then(() => { 
                           this.initializeBookingsTable(); 
                        });
                    } else if (tabName === 'calendar') {
                        this.fetchBookings().then(() => {
                            this.initializeFullCalendar();
                        });
                    } else if (tabName === 'home') {
                        if (!this.homeSelectedDate) this.homeSelectedDate = this.todayString;
                        this.fetchBookings(); 
                    }
                },
                getLabName(labId) {
                    const lab = this.labs.find(l => l.id === labId);
                    return lab ? lab.name : 'ไม่พบห้อง';
                },
                formatDate(inputDate, type = 'short') {
                    if (!inputDate) return '';
                    let date;
                    if (typeof inputDate === 'string') {
                        date = new Date(inputDate.includes('T') ? inputDate : inputDate + 'T00:00:00');
                    } else if (inputDate instanceof Date) {
                        date = inputDate;
                    } else {
                        console.error("Invalid date input for formatDate:", inputDate);
                        return 'Invalid Date'; 
                    }
                    const optionsDate = { year: 'numeric', month: 'long', day: 'numeric', timeZone: 'Asia/Bangkok' };
                    const optionsShortDate = { day:'2-digit', month:'2-digit', year:'numeric', timeZone: 'Asia/Bangkok'};
                    const optionsTime = { hour: '2-digit', minute: '2-digit', hour12: false, timeZone: 'Asia/Bangkok' };
                    if (type === 'full') return date.toLocaleDateString('th-TH', optionsDate);
                    if (type === 'datetime') return `${date.toLocaleDateString('th-TH', optionsShortDate)} ${date.toLocaleTimeString('th-TH', optionsTime)}`;
                    return date.toLocaleDateString('th-TH', optionsShortDate);
                },
                generateDatesForForm() { 
                    const dates = [];
                    const today = new Date();
                    for (let i = 0; i < 11; i++) { 
                        const date = new Date(today);
                        date.setDate(today.getDate() + i);
                        dates.push({
                            value: `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`,
                            text: date.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' })
                        });
                    }
                    this.availableDatesForForm = dates;
                    if (dates.length > 0) {
                        if (!this.formData.bookingDate) this.formData.bookingDate = dates[0].value;
                        if (!this.homeSelectedDate) this.homeSelectedDate = dates[0].value; 
                    }
                },
                handleFileUpload(event) {
                    const file = event.target.files[0];
                    if (file) {
                        if (file.size > 10 * 1024 * 1024) {
                            Swal.fire('ไฟล์ใหญ่เกินไป', 'กรุณาเลือกไฟล์ขนาดไม่เกิน 10MB', 'error');
                            event.target.value = null;
                            this.formData.materialsFile = null; this.formData.materialsFileName = ''; return;
                        }
                        this.formData.materialsFile = file; this.formData.materialsFileName = file.name;
                    } else {
                        this.formData.materialsFile = null; this.formData.materialsFileName = '';
                    }
                },
                async fetchUserNameByPIN() {
                    const pin = this.formData.userPIN;
                    const pinInput = document.getElementById('userPIN');
                    const pinFeedback = document.getElementById('userPINFeedback');
                    const userNameInput = document.getElementById('userNameDisplay'); // Get the display input
                    const userNameFeedback = document.getElementById('userNameFeedback');


                    if (!pin || pin.trim() === '') {
                        this.formData.userName = '';
                        if (pinInput) pinInput.classList.remove('is-invalid', 'is-valid');
                        if (pinFeedback) pinFeedback.textContent = 'กรุณากรอกรหัสประจำผู้จอง';
                        if (userNameInput) userNameInput.classList.remove('is-invalid'); // Clear validation for username display
                        if (userNameFeedback) userNameFeedback.textContent = 'กรุณากรอกรหัสผู้จองที่ถูกต้องเพื่อแสดงชื่อ';
                        return;
                    }

                    if (this.appsScriptUrl === 'YOUR_APPS_SCRIPT_WEB_APP_URL_HERE') {
                        Swal.fire('การตั้งค่าไม่สมบูรณ์', 'กรุณาตั้งค่า URL ของ Apps Script Web App ก่อน', 'warning');
                        if (pinInput) pinInput.classList.add('is-invalid');
                        if (pinFeedback) pinFeedback.textContent = 'ไม่สามารถตรวจสอบรหัสได้: URL ไม่ได้ตั้งค่า';
                        return;
                    }
                    
                    this.isLoading = true;
                    try {
                        const response = await fetch(`${this.appsScriptUrl}?action=getUserName&pin=${encodeURIComponent(pin)}`);
                        const result = await response.json();
                        if (result.status === "success" && result.userName) {
                            this.formData.userName = result.userName;
                            if (pinInput) {
                                pinInput.classList.remove('is-invalid');
                                pinInput.classList.add('is-valid');
                            }
                            if (pinFeedback) pinFeedback.textContent = ''; 
                            if (userNameInput) userNameInput.classList.remove('is-invalid');
                            if (userNameFeedback) userNameFeedback.textContent = '';

                        } else {
                            this.formData.userName = '';
                            Swal.fire('ไม่พบข้อมูล', result.message || 'ไม่พบรหัสประจำผู้จองนี้ หรือรหัสไม่ถูกต้อง', 'error');
                            if (pinInput) {
                                pinInput.classList.remove('is-valid');
                                pinInput.classList.add('is-invalid');
                            }
                            if (pinFeedback) pinFeedback.textContent = result.message || 'ไม่พบรหัสประจำผู้จองนี้';
                            if (userNameInput) userNameInput.classList.add('is-invalid'); // Mark username as problematic if PIN fails
                            if (userNameFeedback) userNameFeedback.textContent = 'กรุณากรอกรหัสผู้จองที่ถูกต้องเพื่อแสดงชื่อ';

                        }
                    } catch (error) {
                        console.error('Error fetching user name by PIN:', error);
                        Swal.fire('เกิดข้อผิดพลาด', 'ไม่สามารถตรวจสอบรหัสผู้จองได้: ' + error.message, 'error');
                        this.formData.userName = '';
                        if (pinInput) {
                            pinInput.classList.remove('is-valid');
                            pinInput.classList.add('is-invalid');
                        }
                        if (pinFeedback) pinFeedback.textContent = 'เกิดข้อผิดพลาดในการตรวจสอบรหัส';
                        if (userNameInput) userNameInput.classList.add('is-invalid');
                        if (userNameFeedback) userNameFeedback.textContent = 'เกิดข้อผิดพลาดในการตรวจสอบชื่อผู้ใช้';

                    } finally {
                        this.isLoading = false;
                    }
                },
                async checkSlotConflict(labId, bookingDate, startPeriodValue, endPeriodValue) {
                    const startIndex = this.periods.findIndex(p => p.value === startPeriodValue);
                    const endIndex = this.periods.findIndex(p => p.value === endPeriodValue);
                    if (startIndex === -1 || endIndex === -1 || startIndex > endIndex) return true;
                    for (let i = startIndex; i <= endIndex; i++) {
                        if (this.isPeriodBooked(labId, bookingDate, this.periods[i].value)) return true;
                    }
                    return false;
                },
                isPeriodBooked(labId, bookingDate, periodValue) {
                    return this.bookings.some(b => {
                        if (b.lab === labId && b.bookingDate === bookingDate) {
                            const bookingStartIndex = this.periods.findIndex(p => p.value === b.startPeriodValue);
                            const bookingEndIndex = this.periods.findIndex(p => p.value === b.endPeriodValue);
                            const checkIndex = this.periods.findIndex(p => p.value === periodValue);
                            if (bookingStartIndex === -1 || bookingEndIndex === -1 || checkIndex === -1) return false;
                            return checkIndex >= bookingStartIndex && checkIndex <= bookingEndIndex;
                        }
                        return false;
                    });
                },
                generateFullPeriodText(startValue, endValue) {
                    const startDetails = this.getPeriodDetails(startValue);
                    const endDetails = this.getPeriodDetails(endValue);
                    if (!startDetails || !endDetails) return "N/A";
                    if (startValue === endValue) return startDetails.text;
                    return `${startDetails.periodNumberText} - ${endDetails.periodNumberText} (${startDetails.startTime} - ${endDetails.endTime} น.)`;
                },
                async handleFormSubmitAttempt() { 
                    const form = document.getElementById('bookingForm');
                    form.classList.add('was-validated'); // Add was-validated to show all feedback

                    // Check standard HTML5 validity first
                    if (!form.checkValidity()) {
                        Swal.fire('ข้อมูลไม่สมบูรณ์', 'กรุณากรอกข้อมูลที่จำเป็นให้ครบถ้วนและถูกต้อง', 'warning');
                        return;
                    }
                    // Additional check for userName if PIN was entered but name not fetched
                    if (this.formData.userPIN && !this.formData.userName) {
                        Swal.fire('รหัสผู้จอง', 'ไม่พบชื่อผู้ใช้สำหรับรหัสที่กรอก กรุณาตรวจสอบรหัสอีกครั้ง', 'warning');
                        const pinInput = document.getElementById('userPIN');
                        if(pinInput) pinInput.classList.add('is-invalid');
                        const userNameFeedback = document.getElementById('userNameFeedback');
                        if(userNameFeedback) userNameFeedback.style.display = 'block'; // Ensure feedback is visible
                        return;
                    }
                    
                    await this.confirmAndSubmitBooking();
                },
                async confirmAndSubmitBooking() {
                    this.isLoading = true; 
                    await this.fetchBookings(); 

                    const conflict = await this.checkSlotConflict(this.formData.lab, this.formData.bookingDate, this.formData.startPeriodValue, this.formData.endPeriodValue);
                    if (conflict) {
                        Swal.fire('ห้องไม่ว่าง', 'ห้องปฏิบัติการนี้ถูกจองแล้วในช่วงวันและเวลาที่คุณเลือก กรุณาเลือกใหม่', 'warning');
                        this.isLoading = false; 
                        return;
                    }
                    this.isLoading = false; 

                    const bookingSummaryHtml = `
                        <div style="text-align: left; font-size: 0.9rem;">
                            <p><strong>รหัสผู้จอง:</strong> ${this.formData.userPIN || 'ไม่ได้ระบุ'}</p>
                            <p><strong>ผู้ขอใช้:</strong> ${this.formData.userName}</p>
                            <p><strong>ห้องปฏิบัติการ:</strong> ${this.getLabName(this.formData.lab)}</p>
                            <p><strong>วันที่:</strong> ${this.formatDate(this.formData.bookingDate, 'full')}</p>
                            <p><strong>เวลา:</strong> ${this.generateFullPeriodText(this.formData.startPeriodValue, this.formData.endPeriodValue)}</p>
                            <p><strong>สอนชั้น:</strong> ${this.formData.studentClass}</p>
                            <p><strong>จำนวนนักเรียน:</strong> ${this.formData.studentCount}</p>
                            <p><strong>เรื่องที่สอน:</strong> ${this.formData.topic}</p>
                            <p><strong>ไฟล์แนบ:</strong> ${this.formData.materialsFileName || 'ไม่มี'}</p>
                        </div>
                    `;

                    Swal.fire({
                        title: 'ยืนยันข้อมูลการจอง',
                        html: bookingSummaryHtml,
                        icon: 'info',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'ยืนยันการจอง',
                        cancelButtonText: 'ยกเลิก'
                    }).then(async (result) => {
                        if (result.isConfirmed) {
                            await this.proceedWithActualSubmission();
                        }
                    });
                },
                async proceedWithActualSubmission() {
                    this.isLoading = true;
                    const form = document.getElementById('bookingForm'); 

                    if (this.appsScriptUrl === 'YOUR_APPS_SCRIPT_WEB_APP_URL_HERE') {
                        Swal.fire('การตั้งค่าไม่สมบูรณ์', 'กรุณาตั้งค่า URL ของ Apps Script Web App ในโค้ดก่อน', 'error');
                        this.isLoading = false; return;
                    }
                    
                    const payload = new FormData();
                    for (const key in this.formData) {
                        if (this.formData.hasOwnProperty(key)) {
                            if (key === 'materialsFile' && this.formData[key]) {
                                payload.append(key, this.formData[key], this.formData.materialsFileName);
                            } else if (key !== 'materialsFile') { 
                                payload.append(key, this.formData[key]);
                            }
                        }
                    }
                    payload.set('periodText', this.generateFullPeriodText(this.formData.startPeriodValue, this.formData.endPeriodValue));
                    if (!this.formData.materialsFile) { 
                        payload.set('materialsFileName', '');
                    }
                    payload.append('submissionTimestamp', new Date().toISOString());

                    try {
                        const response = await fetch(this.appsScriptUrl, { method: 'POST', body: payload });
                        const result = await response.json();
                        if (result.status === "success") {
                            Swal.fire('การจองสำเร็จ!', result.message || 'ข้อมูลการจองของคุณถูกบันทึกแล้ว', 'success');
                            this.formData = { userPIN:'', userName: '', lab: '', bookingDate: this.availableDatesForForm[0].value, startPeriodValue: '', endPeriodValue: '', studentClass: '', studentCount: null, topic: '', materialsFile: null, materialsFileName: ''};
                            document.getElementById('materialsFile').value = null;
                            form.classList.remove('was-validated'); 
                            const pinInput = document.getElementById('userPIN');
                            if(pinInput) pinInput.classList.remove('is-valid', 'is-invalid');
                            this.fetchBookings(); 
                        } else {
                            if (result.field === "userPIN") {
                                Swal.fire('รหัสผู้จองไม่ถูกต้อง', result.message, 'error');
                                const pinInput = document.getElementById('userPIN');
                                if(pinInput) pinInput.classList.add('is-invalid');
                            } else {
                                Swal.fire('เกิดข้อผิดพลาด', result.message || 'ไม่สามารถบันทึกข้อมูลได้', 'error');
                            }
                            form.classList.add('was-validated'); 
                        }
                    } catch (error) {
                        console.error('Error submitting booking:', error);
                        Swal.fire('เกิดข้อผิดพลาด', 'ไม่สามารถเชื่อมต่อกับเซิร์ฟเวอร์ได้: ' + error.message, 'error');
                        form.classList.add('was-validated'); 
                    } finally {
                        this.isLoading = false;
                    }
                },
                async fetchBookings() {
                    this.isLoading = true;
                    if (this.appsScriptUrl === 'YOUR_APPS_SCRIPT_WEB_APP_URL_HERE' || this.appsScriptUrl.trim() === '') {
                        console.warn("Apps Script URL not set. Using local sample data for bookings.");
                        this.bookings = [
                            { id: '1', userName: 'อ.ธนบดี', lab: 'physics', bookingDate: this.todayString, startPeriodValue: '08:30-09:25', endPeriodValue: '08:30-09:25', studentClass: 'ม.4/1', studentCount: 30, topic: 'กลศาสตร์เบื้องต้น', materialsFileName: 'intro_mech.pdf', materialsFileLink: '#', submissionTimestamp: new Date(new Date().setDate(new Date().getDate()-1)).toISOString() },
                            { id: '2', userName: 'อ.ณัฐชา', lab: 'chemistry', bookingDate: this.todayString, startPeriodValue: '10:20-11:15', endPeriodValue: '11:15-12:10', studentClass: 'ม.5/2', studentCount: 25, topic: 'กรด-เบส (2 คาบ)', materialsFileName: '', materialsFileLink: '', submissionTimestamp: new Date(new Date().setDate(new Date().getDate()-2)).toISOString() },
                            { id: '3', userName: 'อ.สุจิตตรา', lab: 'biology', bookingDate: this.addDays(this.todayString, 1), startPeriodValue: '09:25-10:20', endPeriodValue: '09:25-10:20', studentClass: 'ม.6/1', studentCount: 28, topic: 'พันธุศาสตร์', materialsFileName: 'genetics_notes.docx', materialsFileLink: '#', submissionTimestamp: new Date().toISOString() },
                             { id: '4', userName: 'อ.รังสรรค์', lab: 'physics', bookingDate: this.addDays(this.todayString, 2), startPeriodValue: '13:05-14:00', endPeriodValue: '14:00-14:55', studentClass: 'ม.5/3', studentCount: 32, topic: 'คลื่นและแสง', materialsFileName: '', materialsFileLink: '', submissionTimestamp: new Date(new Date().setDate(new Date().getDate()-3)).toISOString() }
                        ];
                        this.isLoading = false;
                        return Promise.resolve(); 
                    }

                    try {
                       const response = await fetch(this.appsScriptUrl + "?action=getBookings");
                       const data = await response.json();
                       if (data && data.bookings) {
                           this.bookings = data.bookings.map(b => ({
                               ...b,
                               bookingDate: b.bookingDate ? new Date(b.bookingDate.split('T')[0]).toISOString().split('T')[0] : null 
                           }));
                       } else {
                           this.bookings = [];
                       }
                    } catch (error) {
                       console.error("Error fetching bookings:", error);
                       Swal.fire('ข้อผิดพลาด', 'ไม่สามารถดึงข้อมูลการจองได้: ' + error.message, 'error');
                       this.bookings = [];
                    } finally {
                        this.isLoading = false;
                    }
                },
                addDays(dateString, days) {
                    var result = new Date(dateString);
                    result.setDate(result.getDate() + days);
                    return `${result.getFullYear()}-${String(result.getMonth() + 1).padStart(2, '0')}-${String(result.getDate()).padStart(2, '0')}`;
                },
                getLabPeriodStatusText(labId, dateToCheck, periodValue) {
                    if (this.isPeriodBooked(labId, dateToCheck, periodValue)) {
                        const checkIndex = this.periods.findIndex(p => p.value === periodValue);
                        const booking = this.bookings.find(b => {
                            if (b.lab === labId && b.bookingDate === dateToCheck) {
                                const bookingStartIndex = this.periods.findIndex(p => p.value === b.startPeriodValue);
                                const bookingEndIndex = this.periods.findIndex(p => p.value === b.endPeriodValue);
                                if (bookingStartIndex === -1 || bookingEndIndex === -1 || checkIndex === -1) return false;
                                return checkIndex >= bookingStartIndex && checkIndex <= bookingEndIndex;
                            }
                            return false;
                        });
                        if (booking && booking.userName) {
                            return `ไม่ว่าง - ${booking.userName}`;
                        }
                        return 'ไม่ว่าง'; 
                    }
                    return ''; 
                },
                getLabPeriodStatusClass(labId, dateToCheck, periodValue) {
                    return this.isPeriodBooked(labId, dateToCheck, periodValue) ? 'status-booked' : 'status-available';
                },
                getPeriodDisplay(periodValue, type) {
                    const details = this.getPeriodDetails(periodValue);
                    if (!details) return 'N/A';
                    return `${details.periodNumberText} (${type === 'start' ? details.startTime : details.endTime} น.)`;
                }
            },
            watch: {
                'formData.startPeriodValue'(newValue) {
                    if (newValue) {
                        const startIndex = this.periods.findIndex(p => p.value === newValue);
                        const endIndex = this.periods.findIndex(p => p.value === this.formData.endPeriodValue);
                        if (endIndex !== -1 && endIndex < startIndex) {
                            this.formData.endPeriodValue = newValue;
                        }
                        if (!this.formData.endPeriodValue) {
                             this.formData.endPeriodValue = newValue;
                        }
                    }
                },
                sortedAllBookings: { 
                    handler() {
                        if (this.activeTab === 'table') {
                            this.initializeBookingsTable(); 
                        }
                    },
                    deep: true
                },
                calendarActiveLabTab() { 
                    if (this.activeTab === 'calendar' && this.calendarInstance) {
                        this.calendarInstance.removeAllEvents(); 
                        this.calendarInstance.addEventSource(this.getCalendarEvents());
                    }
                },
                bookings: { 
                    handler() {
                        if (this.activeTab === 'calendar' && this.calendarInstance) {
                            this.calendarInstance.removeAllEvents();
                            this.calendarInstance.addEventSource(this.getCalendarEvents());
                        }
                        if (this.activeTab === 'table') {
                             this.$nextTick(() => { // Ensure DOM is updated before re-initializing DataTable
                                this.initializeBookingsTable();
                            });
                        }
                    },
                    deep: true
                }
            },
            mounted() {
                this.generateDatesForForm(); 
                this.fetchBookings().then(() => { 
                    if (this.activeTab === 'table') {
                       this.initializeBookingsTable(); 
                    } else if (this.activeTab === 'calendar') {
                       this.initializeFullCalendar();
                    }
                });
            }
        };

        Vue.createApp(App).mount('#app');
    </script>
</body>
</html>
